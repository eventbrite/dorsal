/**
 * @license
 * Copyright 2014 Eventbrite
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 *
 * You may obtain a copy of the License at
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
/*! dorsal - v0.6.5 - 2016-09-30 */
!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define([],b):a.Dorsal=b()}(this,function(){function a(a){return 1===a.nodeType}function b(a){return 9===a.nodeType}function c(a,b){var c=a.length,d=0;if(a.indexOf)return a.indexOf(b);for(;d<c;d++)if(a[d]===b)return d;return-1}function d(a){var b,c=[];if(!a)return c;if(Object.keys)return Object.keys(a);for(b in a)hasOwnProperty.call(a,b)&&c.push(b);return c}var e=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(){return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}}(),f=function(){};f.prototype.VERSION="0.6.3",f.prototype.CSS_PREFIX=".js-d-",f.prototype.DATA_IGNORE_PREFIX="xd",f.prototype.DATA_PREFIX="d",f.prototype.DATA_DORSAL_WIRED="data-"+f.prototype.DATA_IGNORE_PREFIX+"-wired",f.prototype.GUID_KEY="dorsal-guid",f.prototype.ELEMENT_TO_PLUGINS_MAP={},f.prototype.DEBUG=!1,f.prototype.plugins={},f.prototype.registerPlugin=function(a,b){this.plugins[a]=b},f.prototype.unregisterPlugin=function(a){delete this.plugins[a]},f.prototype._getDatasetAttributes=function(a){var b=a.dataset,c={};for(var d in b)if(new RegExp("^"+this.DATA_PREFIX+"[A-Z]").test(d)){var e=d.substr(this.DATA_PREFIX.length),f=e[0].toLowerCase()+e.substr(1);c[f]=b[d]}return c},f.prototype._normalizeDataAttribute=function(a){return a.toUpperCase().replace("-","")},f.prototype._getDataAttributes=function(a){var b={},c=a.attributes,d=c.length,e="name",f=0;for(f=0;f<d;f++)if(new RegExp("^data-"+this.DATA_PREFIX+"-").test(c[f][e])){var g=c[f][e].substr(5+this.DATA_PREFIX.length+1).toLowerCase().replace(/(\-[a-zA-Z])/g,this._normalizeDataAttribute);b[g]=c[f].value}return b},f.prototype._getAttributes=function(a){return a.dataset?this._getDatasetAttributes(a):this._getDataAttributes(a)},f.prototype._runPlugin=function(a,b){var c=new DorsalLog(this.DEBUG);if(a.getAttribute(this.DATA_DORSAL_WIRED)&&a.getAttribute(this.DATA_DORSAL_WIRED).indexOf(b)!==-1)return c.log("node already wired: "+a),!1;var d=this._getAttributes(a),f=a.getAttribute(this.DATA_DORSAL_WIRED),g=this.plugins[b],h={el:a,data:d},i=a.getAttribute(this.GUID_KEY);return i||(i=e(),a.setAttribute(this.GUID_KEY,i),this.ELEMENT_TO_PLUGINS_MAP[i]={}),c.log("plugin execution start",{guid:i,pluginName:b}),"function"==typeof g?this.ELEMENT_TO_PLUGINS_MAP[i][b]=g.call(a,h):"object"==typeof g&&(this.ELEMENT_TO_PLUGINS_MAP[i][b]=g.create.call(a,h)),c.log("plugin execution end",{guid:i,pluginName:b}),f?a.setAttribute(this.DATA_DORSAL_WIRED,f+" "+b):a.setAttribute(this.DATA_DORSAL_WIRED,b),i},f.prototype.registeredPlugins=function(){var a=d(this.plugins);return a.length||console&&console.warn&&console.warn("No plugins registered with Dorsal"),a},f.prototype._wireElementsFrom=function(a){var b,c,d,e=a&&"querySelectorAll"in a,f=this.registeredPlugins(),g=0,h=[];if(!e)return void log.log("invalid Node: "+prentNode);for(b=f[g++];b;)c=a.querySelectorAll(this.CSS_PREFIX+b),c.length&&(d=this._wireElements(c,[b]),h=h.concat(d)),b=f[g++];return h},f.prototype._wireElements=function(a,b){if(!a.length){var c=new DorsalLog(this.DEBUG);return void c.log("no nodes to wire: "+a)}for(var d=0,e=a[d++],f=[];e;)f.push(this._wireElement(e,b)),e=a[d++];return f},f.prototype._wireElement=function(a,b){var c=this,d=new DorsalDeferred,e=new DorsalLog(this.DEBUG);return window.setTimeout(function(){var f,g,h,i=a&&"className"in a,j=0;if(!i)return void e.log("invalid node to wire: "+a);for(b.length||(b=c.registeredPlugins()),g=b[j++];g;)f=c.CSS_PREFIX+g,a.className.indexOf(f.substr(1))>-1&&(h=c._runPlugin(a,g),d.notify(g,h,c),e.end(h)),g=b[j++];d.resolve()},0),d.promise()},f.prototype._detachPlugin=function(a,b){var d,e=!1;return"string"==typeof a.getAttribute(this.DATA_DORSAL_WIRED)&&(a.getAttribute(this.DATA_DORSAL_WIRED).indexOf(b)>-1&&this.plugins[b].destroy&&(this.plugins[b].destroy({el:a,data:this._getAttributes(a),instance:this.ELEMENT_TO_PLUGINS_MAP[a.getAttribute(f.prototype.GUID_KEY)][b]}),e=!0),d=a.getAttribute(this.DATA_DORSAL_WIRED).split(" "),d.splice(c(d,b),1),a.setAttribute(this.DATA_DORSAL_WIRED,d.join(" ")),e)},f.prototype.unwire=function(a,b){if(b)return this._detachPlugin(a,b);for(var c,d=a.getAttribute(this.DATA_DORSAL_WIRED).split(" "),e=d.length,f=!1,g=0;g<e;g++)c=d[g],this._detachPlugin(a,c)&&(f=!0);return f},f.prototype.wire=function(c,d){var e,f=new DorsalDeferred(this.ELEMENT_TO_PLUGINS_MAP),g=[];if(arguments.length&&!c)return f.resolve().promise();switch(arguments.length){case 1:g=b(c)||a(c)?this._wireElementsFrom(c):this._wireElements(c,[]);break;case 2:e=b(c)?"_wireElementsFrom":a(c)?"_wireElement":"_wireElements",g=this[e](c,[d]);break;default:g=this._wireElementsFrom(document)}return f.when(g)},f.prototype.rewire=function(a,b){var c;return this.unwire(a,b),b?c=this.wire(a,b):(a=[a],c=this.wire(a)),c},f.prototype.get=function(b){var c,d,e=[],f=0;for(a(b)&&(b=[b]),d=b[f++];d;)c=this._instancesFor(d),c&&e.push(c),d=b[f++];return e},f.prototype._instancesFor=function(b){var c=a(b)?b.getAttribute(this.GUID_KEY):b;return this.ELEMENT_TO_PLUGINS_MAP[c]};var g=new f;return g.create=function(){return new f},DorsalDeferred=function(a){var b,c="pending",d=[],e=[],f=[],g=this;b={state:function(){return g.state()},done:function(b){return"resolved"===c&&b.call(g,a),d.push(b),g.promise()},fail:function(b){return"rejected"===c&&b.call(g,a),e.push(b),g.promise()},progress:function(a){return f.push(a),g}},g.state=function(){return c},g.notify=function(){var a,b=f.length;for(a=0;a<b;a++)f[a].apply(g,arguments)},g.reject=function(){var b,d=e.length;for(c="rejected",b=0;b<d;b++)e[b].call(g,a);return g},g.resolve=function(){var b,e=d.length;for(c="resolved",b=0;b<e;b++)d[b].call(g,a);return g},g.promise=function(){return b},g.when=function(b){function c(){f++,f>=h&&i.resolve()}function d(){i.notify(g,arguments)}for(var e=0,f=0,h=b&&b.length?b.length:0,i=new DorsalDeferred(a);e<h;e++)b[e].done(c).fail(c).progress(d);return h||i.resolve(),i.promise()}},DorsalHistoryLog={},DorsalLog=function(a){"use strict";var a=a||!1,b=(console&&console.log,DorsalHistoryLog),c=this,d=function(b,c){if(a){var d=c?"timeEnd":"time";console[d]&&console[d](b)}},e=function(a){window.setTimeout(function(){var c=0,d=b[a]||[];if(d.length){console.group(a);for(var e=d[c++];e;)console[e.msgType||"log"](e.time,"message:",e.msg,"pluginName:",e.pluginName),e=d[c++];console.groupEnd(),delete b[a]}},0)},f=function(c,e,f){if(a){var f=f||{},g=f.guid;g?(d(g),b[g]||(b[g]=[]),b[g].push({msg:c,time:(new Date).getTime(),pluginName:f.pluginName,msgType:e})):console&&console[e]&&console[e](c)}};return c.active=function(){return a},c.end=function(a){d(a,!0),e(a)},c.log=function(a,b){f(a,"log",b)},c.warn=function(a,b){f(a,"warn",b)},c.info=function(a,b){f(a,"info",b)},c},g});